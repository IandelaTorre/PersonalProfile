---
import BaseLayout from "../layouts/BaseLayout.astro";
import { getLangFromUrl, useTranslations } from "../i18n/utils";
import Card from "../components/ui/Card.astro";
import Badge from "../components/ui/Badge.astro";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

type BadgeColor =
  | "blue"
  | "indigo"
  | "purple"
  | "pink"
  | "red"
  | "orange"
  | "amber"
  | "yellow"
  | "lime"
  | "green"
  | "emerald"
  | "teal"
  | "cyan"
  | "sky"
  | "slate"
  | "gray"
  | "zinc"
  | "neutral"
  | "stone";

// Mapa de colores por tipo de proyecto
const typeColorMap: Record<string, BadgeColor> = {
  iOS: "blue",
  Frontend: "cyan",
  Backend: "slate",
  Android: "green",
};

// Mapa de tags -> color, alineado con tu TechStack
const tagColorMap: Record<string, BadgeColor> = {
  // iOS
  Swift: "orange",
  UIKit: "indigo",
  Storyboards: "indigo",
  "Stack Views": "indigo",
  MVVM: "slate",
  "Clean Architecture": "slate",
  Coordinator: "slate",
  Coordinators: "slate",
  DI: "slate",
  "Dependency Injection": "slate",
  Alamofire: "red",
  "Local Persistence": "green",
  CoreData: "green",
  "Unit Tests (XCTest)": "amber",

  // Backend
  JavaScript: "yellow",
  Prisma: "purple",
  PostgreSQL: "blue",
  Express: "gray",
  "REST API": "zinc",
  "REST APIs": "zinc",
  "JWT Auth": "zinc",
  Supabase: "green",
  Render: "gray",

  // Frontend / Web
  Astro: "orange",
  "Tailwind CSS": "cyan",
  TypeScript: "blue",
  i18n: "stone",
  GSAP: "green",
  Markdown: "neutral",
  Preline: "indigo",
  Vercel: "gray",

  // Android
  Android: "green",
  Kotlin: "purple",
  SQLite: "blue",
  "Google Drive API": "blue",
  "Material Design": "pink",
};

function getTagColor(tag: string): BadgeColor {
  return tagColorMap[tag] ?? "gray";
}

const projects = [
  {
    title: "TaskFlow",
    description: t("projects.proj1.description"),
    tags: [
      "Swift",
      "UIKit",
      "Storyboards",
      "Alamofire",
      "Clean Architecture",
      "CoreData",
      "Unit Tests (XCTest)",
    ],
    image: "/images/projects/taskflow-banner.webp",
    type: "iOS",
    url: "https://github.com/IandelaTorre/TaskFlow",
  },
  {
    title: "My Calculator",
    description: t("projects.proj2.description"),
    tags: [
      "Swift",
      "UIKit",
      "Storyboards",
      "MVVM",
      "DI",
      "Unit Tests (XCTest)",
      "Stack Views",
      "Coordinator",
    ],
    image: "/images/projects/calculator-banner.webp",
    type: "iOS",
    url: "https://github.com/IandelaTorre/MyCalculator",
  },
  {
    title: "Coin Converter",
    description: t("projects.proj3.description"),
    tags: [
      "Swift",
      "UIKit",
      "Storyboards",
      "MVVM",
      "DI",
      "Alamofire",
      "Unit Tests (XCTest)",
      "Local Persistence",
    ],
    image: "/images/projects/coin-converter-banner.webp",
    type: "iOS",
    url: "https://github.com/IandelaTorre/CoinConverter",
  },
  {
    title: "Basic API",
    description: t("projects.proj4.description"),
    tags: [
      "JavaScript",
      "Prisma",
      "PostgreSQL",
      "Express",
      "REST API",
      "JWT Auth",
      "Supabase",
      "Render",
    ],
    image: "/images/projects/basic-api-banner.webp",
    type: "Backend",
    url: "https://github.com/IandelaTorre/BasicAPI",
  },
  {
    title: "Personal Website",
    description: t("projects.proj5.description"),
    tags: [
      "Astro",
      "Tailwind CSS",
      "TypeScript",
      "i18n",
      "GSAP",
      "Markdown",
      "Preline",
      "Vercel",
    ],
    image: "/images/projects/personal-website-banner.webp",
    type: "Frontend",
    url: "https://github.com/IandelaTorre/PersonalProfile",
  },
  {
    title: "Memorama App Android",
    description: t("projects.proj6.description"),
    tags: [
      "Android",
      "Kotlin",
      "MVVM",
      "SQLite",
      "Google Drive API",
      "Clean Architecture",
    ],
    image: "/images/projects/memorama-android-banner.webp",
    type: "Android",
    url: "https://github.com/IandelaTorre/ETSMemorama",
  },
];
---
<BaseLayout title={`Ian Axel - ${t("nav.projects")}`}>
  <section
  id="projects"
  class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto"
>
  <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
    <h2 class="text-2xl font-bold md:text-4xl md:leading-tight dark:text-white">
      {t("projects.title")}
    </h2>
    <p class="mt-1 text-gray-600 dark:text-neutral-400">
      {t("projects.viewAll")}
    </p>
  </div>

  <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {
      projects.map((project) => (
        <Card
          href={project.url}
          target="_blank"
          class="project-card h-full opacity-0 translate-y-12 scale-95"
        >
          <div class="aspect-w-16 aspect-h-9 mb-4 overflow-hidden rounded-xl">
            <img
              class="w-full h-48 object-cover rounded-xl transition-transform duration-500 hover:scale-105"
              src={project.image}
              alt={project.title}
            />
          </div>
          <div class="flex flex-col h-full">
            <div class="flex justify-between items-center mb-2">
              <Badge label={project.type} color="gray" />
            </div>
            <h3 class="text-xl font-bold text-gray-800 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-500">
              {project.title}
            </h3>
            <p class="mt-3 text-justify text-gray-600 dark:text-neutral-400 flex-grow">
              {project.description}
            </p>
            <div class="mt-4 flex flex-wrap gap-2">
              {project.tags.map((tag) => (
                <Badge label={tag} color={getTagColor(tag)} />
              ))}
            </div>
          </div>
        </Card>
      ))
    }
  </div>

  <div class="mt-12 text-center">
    <p class="mb-4 text-gray-600 dark:text-neutral-400">
      {t("projects.moreProjects")}
    </p>
    <a
      href="https://github.com/IandelaTorre"
      target="_blank"
      rel="noopener noreferrer"
      class="inline-flex items-center gap-x-2 bg-white border border-gray-200 text-gray-800 text-sm font-medium rounded-full py-3 px-6 shadow-sm hover:bg-gray-50 disabled:opacity-50 disabled:pointer-events-none dark:bg-neutral-900 dark:border-neutral-700 dark:text-white dark:hover:bg-neutral-800"
    >
      <svg
        class="flex-shrink-0 w-4 h-4"
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        viewBox="0 0 16 16"
      >
        <path
          d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"
        ></path>
      </svg>
      {t("projects.ctaGithub")}
    </a>
  </div>
</section>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  ScrollTrigger.batch(".project-card", {
    start: "top 80%",
    onEnter: (elements) => {
      gsap.to(elements, {
        opacity: 1,
        y: 0,
        scale: 1,
        duration: 0.8,
        stagger: 0.15,
        ease: "power3.out",
      });
    },
    once: true,
  });
</script>
</BaseLayout>
