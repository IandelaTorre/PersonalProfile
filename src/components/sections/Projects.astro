---
import Card from "../ui/Card.astro";
import Badge from "../ui/Badge.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

type BadgeColor =
  | "blue"
  | "indigo"
  | "purple"
  | "pink"
  | "red"
  | "orange"
  | "amber"
  | "yellow"
  | "lime"
  | "green"
  | "emerald"
  | "teal"
  | "cyan"
  | "sky"
  | "slate"
  | "gray"
  | "zinc"
  | "neutral"
  | "stone";

// Mapa de colores por tipo de proyecto
const typeColorMap: Record<string, BadgeColor> = {
  iOS: "blue",
  Frontend: "cyan",
  Backend: "slate",
  Android: "green",
};

// Mapa de tags -> color, alineado con tu TechStack
const tagColorMap: Record<string, BadgeColor> = {
  // iOS
  Swift: "orange",
  UIKit: "indigo",
  Storyboards: "indigo",
  "Stack Views": "indigo",
  MVVM: "slate",
  "Clean Architecture": "slate",
  Coordinator: "slate",
  Coordinators: "slate",
  DI: "slate",
  "Dependency Injection": "slate",
  Alamofire: "red",
  "Local Persistence": "green",
  CoreData: "green",
  "Unit Tests (XCTest)": "amber",

  // Backend
  JavaScript: "yellow",
  Prisma: "purple",
  PostgreSQL: "blue",
  Express: "gray",
  "REST API": "zinc",
  "REST APIs": "zinc",
  "JWT Auth": "zinc",
  Supabase: "green",
  Render: "gray",

  // Frontend / Web
  Astro: "orange",
  "Tailwind CSS": "cyan",
  TypeScript: "blue",
  i18n: "stone",
  GSAP: "green",
  Markdown: "neutral",
  Preline: "indigo",
  Vercel: "gray",

  // Android
  Android: "green",
  Kotlin: "purple",
  SQLite: "blue",
  "Google Drive API": "blue",
  "Material Design": "pink",
};

function getTagColor(tag: string): BadgeColor {
  return tagColorMap[tag] ?? "gray";
}

const projects = [
  {
    title: "TaskFlow",
    description: t("projects.proj1.description"),
    tags: [
      "Swift",
      "UIKit",
      "Storyboards",
      "Alamofire",
      "Clean Architecture",
      "CoreData",
      "Unit Tests (XCTest)",
    ],
    image: "/images/projects/taskflow-banner.webp",
    type: "iOS",
    url: "https://github.com/IandelaTorre/TaskFlow",
  },
  {
    title: "My Calculator",
    description: t("projects.proj2.description"),
    tags: [
      "Swift",
      "UIKit",
      "Storyboards",
      "MVVM",
      "DI",
      "Unit Tests (XCTest)",
      "Stack Views",
      "Coordinator",
    ],
    image: "/images/projects/calculator-banner.webp",
    type: "iOS",
    url: "https://github.com/IandelaTorre/MyCalculator",
  },
  {
    title: "Coin Converter",
    description: t("projects.proj3.description"),
    tags: [
      "Swift",
      "UIKit",
      "Storyboards",
      "MVVM",
      "DI",
      "Alamofire",
      "Unit Tests (XCTest)",
      "Local Persistence",
    ],
    image: "/images/projects/coin-converter-banner.webp",
    type: "iOS",
    url: "https://github.com/IandelaTorre/CoinConverter",
  },
];
---

<section
  id="projects"
  class="max-w-[85rem] px-4 py-10 sm:px-6 lg:px-8 lg:py-14 mx-auto"
>
  <div class="max-w-2xl mx-auto text-center mb-10 lg:mb-14">
    <h2 class="text-2xl font-bold md:text-4xl md:leading-tight dark:text-white">
      {t("projects.title")}
    </h2>
    <p class="mt-1 text-gray-600 dark:text-neutral-400">
      {t("projects.viewAll")}
    </p>
  </div>

  <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
    {
      projects.map((project) => (
        <Card
          href={project.url}
          target="_blank"
          class="project-card h-full opacity-0 translate-y-12 scale-95"
        >
          <div class="aspect-w-16 aspect-h-9 mb-4 overflow-hidden rounded-xl">
            <img
              class="w-full h-48 object-cover rounded-xl transition-transform duration-500 hover:scale-105"
              src={project.image}
              alt={project.title}
            />
          </div>
          <div class="flex flex-col h-full">
            <div class="flex justify-between items-center mb-2">
              <Badge label={project.type} color="gray" />
            </div>
            <h3 class="text-xl font-bold text-gray-800 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-500">
              {project.title}
            </h3>
            <p class="mt-3 text-justify text-gray-600 dark:text-neutral-400 flex-grow">
              {project.description}
            </p>
            <div class="mt-4 flex flex-wrap gap-2">
              {project.tags.map((tag) => (
                <Badge label={tag} color={getTagColor(tag)} />
              ))}
            </div>
          </div>
        </Card>
      ))
    }
  </div>
      <p class="mt-6 text-sm text-center text-gray-600 dark:text-neutral-400">{t("projects.more")}
          <a
            href={lang === 'en' ? '/projects' : '/es/projects'}
            class="relative font-medium text-blue-400 hover:text-blue-300
                  bg-gradient-to-r from-blue-400 to-sky-400
                  bg-[length:0%_2px] bg-left-bottom bg-no-repeat
                  transition-all duration-300 ease-out
                  hover:bg-[length:100%_2px]"
          >
            {t("projects.ctaProjects")}</a>.</p>
</section>

<script>
  import gsap from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  ScrollTrigger.batch(".project-card", {
    start: "top 80%",
    onEnter: (elements) => {
      gsap.to(elements, {
        opacity: 1,
        y: 0,
        scale: 1,
        duration: 0.8,
        stagger: 0.15,
        ease: "power3.out",
      });
    },
    once: true,
  });
</script>
