---
import Image from "astro/components/Image.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import LanguageSwitcher from "./LanguageSwitcher";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

const pathname = Astro.url.pathname;
const isHome = pathname === "/" || pathname === "/es" || pathname === "/es/";
const base = lang === "en" ? "/" : "/es/";

const navLinks = [
  {
    href: isHome ? "#hero" : `${base}#hero`,
    label: t("nav.home"),
    isActive: isHome,
  },
  {
    href: lang === "en" ? "/projects" : "/es/projects",
    label: t("nav.projects"),
    isActive: pathname === "/projects" || pathname === "/es/projects",
  },
  {
    href: lang === "en" ? "/about" : "/es/about",
    label: t("nav.about"),
    isActive: pathname === "/about" || pathname === "/es/about",
  },
  {
    href: lang === "en" ? "/notes" : "/es/notes",
    label: t("nav.notes"),
    isActive: pathname === "/notes" || pathname === "/es/notes",
  },
];
---

<header
  class="fixed top-0 w-full z-50 transition-all duration-300 bg-white/70 backdrop-blur-md border-b border-gray-200/50 dark:bg-neutral-900/70 dark:border-white/5"
>
  <nav
    class="max-w-[85rem] w-full mx-auto px-4 sm:px-6 lg:px-8"
    aria-label="Global"
  >
    <div class="flex items-center justify-between h-16">
      <div class="flex items-center gap-4">
        <Image
          height={10}
          width={10}
          src="/images/avatarRecortado.png"
          alt="Logo"
          class="border rounded-full h-12 w-12"
        />
        <div class="flex flex-col">
          <a
            class="flex-none text-sm md:text-lg font-bold dark:text-white"
            href={lang === "en" ? "/" : "/es"}
          >
            Ian Axel Perez de la Torre
          </a>
          <a
            class="flex-none text-xs md:text-base text-gray-600 dark:text-neutral-400"
            href={lang === "en" ? "/" : "/es"}
          >
            {t("hero.title")}
          </a>
        </div>
      </div>

      <div class="hidden md:block">
        <div class="flex items-center gap-2">
          {
            navLinks.map((link) => (
              <a
                class:list={[
                  "px-3 py-1.5 rounded-full text-sm font-medium transition-colors",
                  link.isActive
                    ? "bg-blue-500 text-white shadow-sm"
                    : "text-neutral-500 hover:bg-gray-100 hover:text-gray-900 dark:text-neutral-300 dark:hover:bg-white/5 dark:hover:text-white",
                ]}
                href={link.href}
              >
                {link.label}
              </a>
            ))
          }
          <div class="pl-2 border-l border-gray-200 dark:border-white/10 ml-2">
            <LanguageSwitcher client:load initialLang={lang} />
          </div>
        </div>
      </div>

      <div class="md:hidden flex items-center gap-4">
        <LanguageSwitcher client:load initialLang={lang} />
        <!-- Mobile menu button -->
        <button
          type="button"
          class="hs-collapse-toggle p-2 inline-flex justify-center items-center gap-2 rounded-full border font-medium bg-white text-gray-700 shadow-sm align-middle hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-white focus:ring-blue-600 transition-all text-sm dark:bg-neutral-800 dark:hover:bg-neutral-700 dark:border-neutral-700 dark:text-neutral-400 dark:hover:text-white dark:focus:ring-offset-gray-800"
          data-hs-collapse="#navbar-collapse-with-animation"
          aria-controls="navbar-collapse-with-animation"
          aria-label="Toggle navigation"
        >
          <svg
            class="hs-collapse-open:hidden w-4 h-4"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              fill-rule="evenodd"
              d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"
            ></path>
          </svg>
          <svg
            class="hs-collapse-open:block hidden w-4 h-4"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"
            ></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div
      id="navbar-collapse-with-animation"
      class="hs-collapse hidden overflow-hidden transition-all duration-300 basis-full grow md:hidden"
    >
      <div class="flex flex-col gap-y-2 mt-5 pb-5">
        {
          navLinks.map((link) => (
            <a
              class:list={[
                "px-3 py-2 rounded-lg text-sm font-medium transition-colors",
                link.isActive
                  ? "bg-blue-500 text-white"
                  : "text-gray-600 hover:text-blue-600 hover:bg-gray-100 dark:text-neutral-300 dark:hover:bg-neutral-800 dark:hover:text-white",
              ]}
              href={link.href}
            >
              {link.label}
            </a>
          ))
        }
      </div>
    </div>
  </nav>
</header>

<script>
  // Close mobile menu when a link is clicked
  const navLinks = document.querySelectorAll(
    "#navbar-collapse-with-animation a",
  );
  const collapseToggle = document.querySelector(
    '[data-hs-collapse="#navbar-collapse-with-animation"]',
  ) as HTMLElement | null;
  const collapseMenu = document.getElementById(
    "navbar-collapse-with-animation",
  );

  navLinks.forEach((link) => {
    link.addEventListener("click", () => {
      if (collapseMenu && !collapseMenu.classList.contains("hidden")) {
        // If menu is open, click the toggle to close it via Preline logic
        if (collapseToggle) {
          collapseToggle.click();
        }
      }
    });
  });
</script>
